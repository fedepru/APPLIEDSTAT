boxplot(iris4[,3]~species.name, main='Petal Length', ylim=c(0,8), col = rainbow(3))
boxplot(iris4[,4]~species.name, main='Petal Width', ylim=c(0,8), col = rainbow(3))
n1 <- length(i1)
n2 <- length(i2)
n3 <- length(i3)
n  <- n1 + n2 + n3
g  <- length(levels(species.name))
p  <- 4
Ps <- NULL
for(i in 1:g) {
mvn.test <- mvn(data = iris[get(paste('i',i, sep='')), 1:4])
Ps <- c(Ps, mvn.test$multivariateNormality$`p value`)
}
Ps
pairs(iris[get(paste('i',1, sep='')), 1:4])
# 2) same covariance structure (= same covariance matrix Sigma)
S  <-  cov(iris4)
S1 <-  cov(iris4[i1,])
S2 <-  cov(iris4[i2,])
S3 <-  cov(iris4[i3,])
# Qualitatively:
round(S1, digits=2)
round(S2, digits=2)
round(S3, digits=2)
# Other way to compare: heatmap on the covariance matrices
par(mfrow=c(1,3))
image(S1, col=heat.colors(100),main='Cov. S1', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3), (0:100)/100, na.rm=TRUE))
image(S2, col=heat.colors(100),main='Cov. S2', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3), (0:100)/100, na.rm=TRUE))
image(S3, col=heat.colors(100),main='Cov. S3', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3), (0:100)/100, na.rm=TRUE))
par(mfrow=c(1,1))
# One-way MANOVA
help(manova)
help(summary.manova)
fit <- manova(as.matrix(iris4) ~ species.name)
summary.manova(fit)
# Via ANOVA: for each of the p=4 variables we perform an ANOVA test
#            to verify if the membership to a group has influence
#            on the mean of the variable (we explore separately the
#            4 axes directions in R^4)
summary.aov(fit)
### Via Bonferroni
alpha <- 0.05
k <- p * g * (g - 1) / 2
qT <- qt(1 - alpha / (2 * k), n - g)
W <- summary.manova(fit)$SS$Residuals
m  <- sapply(iris4, mean)         # estimates mu
m1 <- sapply(iris4[i1,], mean)    # estimates mu.1 = mu + tau.1
m2 <- sapply(iris4[i2,], mean)    # estimates mu.2 = mu + tau.2
m3 <- sapply(iris4[i3,], mean)    # estimates mu.3 = mu + tau.3
inf12 <- m1 - m2 - qT * sqrt(diag(W)/(n-g) * (1/n1+1/n2))
sup12 <- m1 - m2 + qT * sqrt(diag(W)/(n-g) * (1/n1+1/n2))
inf13 <- m1 - m3 - qT * sqrt(diag(W)/(n-g) * (1/n1+1/n3))
sup13 <- m1 - m3 + qT * sqrt(diag(W)/(n-g) * (1/n1+1/n3))
inf23 <- m2 - m3 - qT * sqrt(diag(W)/(n-g) * (1/n2+1/n3))
sup23 <- m2 - m3 + qT * sqrt(diag(W)/(n-g) * (1/n2+1/n3))
CI <- list(setosa_versicolor    = cbind(inf12, sup12),
setosa_virginica     = cbind(inf13, sup13),
versicolor_virginica = cbind(inf23, sup23))
CI
par(mfrow=c(2,4))
boxplot(iris4[,1]~species.name, main='Sepal Length', ylim=c(0,8), col = rainbow(3))
boxplot(iris4[,2]~species.name, main='Sepal Width', ylim=c(0,8), col = rainbow(3))
boxplot(iris4[,3]~species.name, main='Petal Length', ylim=c(0,8), col = rainbow(3))
boxplot(iris4[,4]~species.name, main='Petal Width', ylim=c(0,8), col = rainbow(3))
mg <- rbind(m1,m2,m3)
sp.name <- c('Sepal Length','Sepal Width', 'Petal Length', 'Petal Width')
for(k in 1:4){
plot(c(1,g*(g-1)/2),ylim=c(-4,4), xlim=c(1,3), pch='',
xlab='pairs treat', ylab=paste('CI tau',k),
main=paste('CI tau',sp.name[k]))
lines (c(1,1), c(CI[[1]][k,1],CI[[1]][k,2]));
points(1, mg[1,k]-mg[2,k], pch=16);
points(1, CI[[1]][k,1], col=rainbow(g)[2], pch=16);
points(1, CI[[1]][k,2], col=rainbow(g)[1], pch=16);
lines (c(2,2), c(CI[[2]][k,1],CI[[2]][k,2]));
points(2, mg[1,k]-mg[3,k], pch=16);
points(2, CI[[2]][k,1], col=rainbow(g)[3], pch=16);
points(2, CI[[2]][k,2], col=rainbow(g)[1], pch=16);
lines (c(3,3), c(CI[[3]][k,1],CI[[3]][k,2]));
points(3, mg[2,k]-mg[3,k], pch=16);
points(3, CI[[3]][k,1], col=rainbow(g)[3], pch=16);
points(3, CI[[3]][k,2], col=rainbow(g)[2], pch=16);
abline(h=0)
}
km          <- c(18.7, 16.8, 20.1, 22.4, 14.0, 15.2, 22.0, 23.3)
distr       <- factor(c(rep('Esso', 4), rep('Shell', 4)))
distr
benz        <- factor(c('95','95','98','98','95','95','98','98'))
distr_benz  <- factor(paste(distr, benz))
distr_benz
g <- length(levels(distr)) # number of factor1 levels
b <- length(levels(benz)) # number of factor2 levels
n <- length(km)/(g*b) # group sizes
n
M           <- mean(km) # overall mean
Mdistr      <- tapply(km, distr, mean) # mean per gas station
Mbenz       <- tapply(km, benz, mean) # mean per gasoline type
Mdistr_benz <- tapply(km, distr_benz, mean) # mean per gas station x gasoline type
Mdistr
Mbenz
Mdistr_benz
par(mfrow=c(2,3), las=2)
barplot(rep(M,4), names.arg=levels(distr_benz), ylim=c(0,24), main='No factor')
barplot(rep(Mdistr,each=2), names.arg=levels(distr_benz), ylim=c(0,24),
col=rep(c('blue','red'),each=2), main='Only Fact. Stat.')
barplot(rep(Mbenz,times=2), names.arg=levels(distr_benz), ylim=c(0,24),
col=rep(c('darkgreen','orange'),times=2), main='Only Fact. Gas')
barplot(c(Mdistr[1]+Mbenz[1]-M, Mdistr[1]+Mbenz[2]-M, Mdistr[2]+Mbenz[1]-M,
Mdistr[2]+Mbenz[2]-M), names.arg=levels(distr_benz), ylim=c(0,24),
col=rep(c('darkgreen','orange'),times=2), density=rep(10,4), angle=135,
main='Additive model Stat.+Gas')
barplot(c(Mdistr[1]+Mbenz[1]-M, Mdistr[1]+Mbenz[2]-M, Mdistr[2]+Mbenz[1]-M,
Mdistr[2]+Mbenz[2]-M), names.arg=levels(distr_benz), ylim=c(0,24),
col=rep(c('blue','red'),each=2), density=rep(10,4), add=T)
barplot(Mdistr_benz, names.arg=levels(distr_benz), ylim=c(0,24),
col=rainbow(5)[2:5], main='Model with Interact. Stat.+Gas.')
plot(distr_benz, km, col=rainbow(5)[2:5], ylim=c(0,24),xlab='')
par(mfrow=c(1,1))
fit.aov2.int <- aov(km ~ distr + benz + distr:benz)
summary.aov(fit.aov2.int)
# Additive model:
# X.ijk = mu + tau.i + beta.j + eps.ijk; eps.ijk ~ N(0,sigma^2),
#     i=1,2 (effect station), j=1,2 (effect gasoline)
fit.aov2.ad <- aov(km ~ distr + benz)
summary.aov(fit.aov2.ad)
# Note: These aren't the only tests we can do!
# Example: global test for the joint significance of the two treatments
#          (model without interaction)
SSdistr <- sum(n * b * (Mdistr - M) ^ 2)              # or from the summary: 1.53
# Note: These aren't the only tests we can do!
# Example: global test for the joint significance of the two treatments
#          (model without interaction)
SSdistr <- sum(n * b * (Mdistr - M) ^ 2)              # or from the summary: 1.53
SSbenz  <- sum(n * g * (Mbenz  - M) ^ 2)              # or from the summary: 66.70
SSres <- sum((km - M) ^ 2) - (SSdistr + SSbenz)   # or from the summary: 16.37
Ftot <- ((SSdistr + SSbenz) / (g - 1 + b - 1)) / (SSres / (n * g * b - g - b + 1))
Ptot      <- 1 - pf(Ftot, (g - 1) + (b - 1), n * g * b - g - b + 1) # attention to the dof!
Ptot
### Reduced additive model (ANOVA one-way, b=2):
### X.jk = mu + beta.j + eps.jk; eps.jk~N(0,sigma^2),
###     j=1,2 (effect gasoline)
fit.aov1 <- aov(km ~ benz)
summary.aov(fit.aov1)
SSres <- sum(residuals(fit.aov1)^2)
### Interval at 90% for the differences (reduced additive model)
### [b=2, thus one interval only]
IC <- c(diff(Mbenz) - qt(0.95, (n*g-1)*b) * sqrt(SSres/((n*g-1)*b) *(1/(n*g) + 1/(n*g))),
diff(Mbenz) + qt(0.95, (n*g-1)*b) * sqrt(SSres/((n*g-1)*b) *(1/(n*g) + 1/(n*g))))
names(IC) <- c('Inf', 'Sup')
IC    # IC for mu(98)-mu(95)
plastic <- read.table('T6-4.dat', col.names=c('Ex','Ad','Tr','Gl','Op'))
plastic
Ex   <- factor(plastic$Ex, labels=c('L','H')) # Treat.1
Ex
Ad   <- factor(plastic$Ad, labels=c('L','H')) # Treat.2
ExAd <- factor(paste(Ex, Ad, sep=''))
ExAd
plastic3  <- plastic[,3:5]
### Graphical exploration of the data
# effect of the treatments + their interaction on the first variable
layout(matrix(c(1,1,2,3), 2, byrow=T))
boxplot(plastic3[,1] ~ ExAd, main='Model with Interac. Extrusion+Additive (Tear Resistance)',
ylab='Tr', col='grey95')
boxplot(plastic3[,1] ~ Ex, main='Only Factor Extrusion', ylab='Tr', col=c('red','blue'))
boxplot(plastic3[,1] ~ Ad, main='Only Factor Additive', ylab='Tr', col=c('forestgreen','gold'))
# effect of the treatments + their interaction on the second variable
layout(matrix(c(1,1,2,3), 2, byrow=T))
boxplot(plastic3[,2] ~ ExAd, main='Model with Interac. Extrusion+Additive (Gloss)',
ylab='Gl', col='grey95')
boxplot(plastic3[,2] ~ Ex, main='Only Factor Extrusion', ylab='Gl', col=c('red','blue'))
boxplot(plastic3[,2] ~ Ad, main='Only Factor Additive', ylab='Gl', col=c('forestgreen','gold'))
# effect of the treatments + their interaction on the third variable
layout(matrix(c(1,1,2,3), 2, byrow=T))
boxplot(plastic3[,3] ~ ExAd, main='Model with Interac. Extrusion+Additive (Opacity)',
ylab='Op', col='grey95')
boxplot(plastic3[,3] ~ Ex, main='Only Factor Extrusion', ylab='Op', col=c('red','blue'))
boxplot(plastic3[,3] ~ Ad, main='Only Factor Additive', ylab='Op', col=c('forestgreen','gold'))
par(mfrow=c(1,1))
# effect of the treatments + their interaction on the first variable
layout(matrix(c(1,1,2,3), 2, byrow=T))
boxplot(plastic3[,1] ~ ExAd, main='Model with Interac. Extrusion+Additive (Tear Resistance)',
ylab='Tr', col='grey95')
boxplot(plastic3[,1] ~ Ex, main='Only Factor Extrusion', ylab='Tr', col=c('red','blue'))
boxplot(plastic3[,1] ~ Ad, main='Only Factor Additive', ylab='Tr', col=c('forestgreen','gold'))
# effect of the treatments + their interaction on the second variable
layout(matrix(c(1,1,2,3), 2, byrow=T))
boxplot(plastic3[,2] ~ ExAd, main='Model with Interac. Extrusion+Additive (Gloss)',
ylab='Gl', col='grey95')
boxplot(plastic3[,2] ~ Ex, main='Only Factor Extrusion', ylab='Gl', col=c('red','blue'))
boxplot(plastic3[,2] ~ Ad, main='Only Factor Additive', ylab='Gl', col=c('forestgreen','gold'))
### Verify the assumptions (although we only have 5 data in each group!)
# 1) normality (multivariate) in each group (4 test)
Ps <- c(mvn(plastic3[ExAd==levels(ExAd)[1],],)$multivariateNormality$`p value`,
mvn(plastic3[ExAd==levels(ExAd)[2],],)$multivariateNormality$`p value`,
mvn(plastic3[ExAd==levels(ExAd)[3],],)$multivariateNormality$`p value`,
mvn(plastic3[ExAd==levels(ExAd)[4],],)$multivariateNormality$`p value`)
Ps
pairs(plastic3[ExAd==levels(ExAd)[1],])
pairs(plastic3[ExAd==levels(ExAd)[2],])
# 2) homogeneity of the covariance (qualitatively)
S1 <-  cov(plastic3[ ExAd==levels(ExAd)[1],])
S2 <-  cov(plastic3[ ExAd==levels(ExAd)[2],])
S3 <-  cov(plastic3[ ExAd==levels(ExAd)[3],])
S4 <-  cov(plastic3[ ExAd==levels(ExAd)[4],])
par(mfrow=c(1,4))
image(S1, col=heat.colors(100),main='Cov. S1', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3,S4), (0:100)/100, na.rm=TRUE))
image(S2, col=heat.colors(100),main='Cov. S2', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3,S4), (0:100)/100, na.rm=TRUE))
image(S3, col=heat.colors(100),main='Cov. S3', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3,S4), (0:100)/100, na.rm=TRUE))
image(S4, col=heat.colors(100),main='Cov. S4', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3,S4), (0:100)/100, na.rm=TRUE))
# Two-ways MANOVA
# Model with interaction (complete model):
# X.ijk = mu + tau.i + beta.j + gamma.ij + eps.ijk; eps.ijk ~ N_p(0,Sigma), [p=3]
#     i=1,2 (effect Extrusion), j=1,2 (effect Additive),
#     X.ijs, mu, tau.i, beta.j, gamma.ij in R^3
fit <- manova(as.matrix(plastic3) ~ Ex + Ad + Ex:Ad)
summary.manova(fit)
### Model without interaction (additive model):
### X.ijk = mu + tau.i + beta.j + eps.ijk; eps.ijk~N_p(0,Sigma), [p=3]
###     i=1,2 (effect Extrusion), j=1,2 (effect additive),
###     X.ijs, mu, tau.i, beta.j, in R^3
fit2<- manova(as.matrix(plastic3) ~ Ex + Ad)
summary.manova(fit2)
# ANOVA on the components (we look at the 3 axes-directions in R^3
#                          separately)
summary.aov(fit2)
# Bonferroni
alpha <- 0.05
g <- 2
b <- 2
p <- 3
n <- 5
N <- n*g*b # 20
W <- summary.manova(fit2)$SS$Residuals
W
g*(g-1)/2
# because we have: g levels on the first treatment on p components
#                  b levels on the second treatment on p components
k
qT <- qt(1 - alpha/(2*k), g*b*n-g-b+1)
mExL  <- sapply(plastic3[Ex=='L',],mean)
mExH  <- sapply(plastic3[Ex=='H',],mean)
infEx <- mExH-mExL - qT * sqrt(diag(W)/(g*b*n-g-b+1) * (1/10+1/10))
supEx <- mExH-mExL + qT * sqrt(diag(W)/(g*b*n-g-b+1) * (1/10+1/10))
mAdL  <- sapply(plastic3[Ad=='L',],mean)
mAdH  <- sapply(plastic3[Ad=='H',],mean)
infAd <- mAdH-mAdL - qT * sqrt(diag(W)/(g*b*n-g-b+1) * (1/10+1/10))
supAd <- mAdH-mAdL + qT * sqrt(diag(W)/(g*b*n-g-b+1) * (1/10+1/10))
IC2   <- list(ExH_ExL=cbind(infEx, supEx), AdH_AdL=cbind(infAd, supAd))
IC2
par(mfrow=c(3,4))
boxplot(plastic3[,1]~Ex,   main='Fact.: Extrusion (Tear Resistance)'  , ylab='Tr', col=rainbow(2*6)[c(1,2)], ylim=c(-2,10))
plot(c(1,g*(g-1)/2),range(IC2[[1]][1,]), pch='',main='IC (tau.1-tau.2)[1]',xlab='pairs treat', ylab='IC (tau.1-tau.2)[1]', ylim=c(-2,10))
lines(c(1,1), c(IC2[[1]][1,1],IC2[[1]][1,2]), col='grey55');
points(1, (mExH-mExL)[1], pch=16, col='grey55');
points(1, IC2[[1]][1,1], col=rainbow(2*6)[1], pch=16);
points(1, IC2[[1]][1,2], col=rainbow(2*6)[2], pch=16);
abline(h=0)
boxplot(plastic3[,1]~Ad,   main='Fact.: Additive (Tear Resistance)'  , ylab='Tr', col=rainbow(2*6)[c(7,8)], ylim=c(-2,10))
plot(c(1,g*(g-1)/2),range(IC2[[2]][1,]), pch='',main='IC (beta.1-beta.2)[1]',xlab='pairs treat', ylab='IC (beta.1-beta.2)[1]', ylim=c(-2,10))
lines(c(1,1), c(IC2[[2]][1,1],IC2[[2]][1,2]), col='grey55');
points(1, (mAdH-mAdL)[1], pch=16, col='grey55');
points(1, IC2[[2]][1,1], col=rainbow(2*6)[7], pch=16);
points(1, IC2[[2]][1,2], col=rainbow(2*6)[8], pch=16);
abline(h=0)
boxplot(plastic3[,2]~Ex,   main='Fact.: Extrusion (Gloss)'  , ylab='Gl', col=rainbow(2*6)[c(3,4)], ylim=c(-2,10))
plot(c(1,g*(g-1)/2),range(IC2[[1]][2,]), pch='',main='IC (tau.1-tau.2)[2]',xlab='pairs treat', ylab='IC (tau.1-tau.2)[2]', ylim=c(-2,10))
lines(c(1,1), c(IC2[[1]][2,1],IC2[[1]][2,2]), col='grey55');
points(1, (mExH-mExL)[2], pch=16, col='grey55');
points(1, IC2[[1]][2,1], col=rainbow(2*6)[3], pch=16);
points(1, IC2[[1]][2,2], col=rainbow(2*6)[4], pch=16);
abline(h=0)
boxplot(plastic3[,2]~Ex,   main='Fact.: Additive (Gloss)'  , ylab='Gl', col=rainbow(2*6)[c(9,10)], ylim=c(-2,10))
plot(c(1,g*(g-1)/2),range(IC2[[2]][2,]), pch='',main='IC (beta.1-beta.2)[2]',xlab='pairs treat', ylab='IC (beta.1-beta.2)[2]', ylim=c(-2,10))
lines(c(1,1), c(IC2[[2]][2,1],IC2[[2]][2,2]), col='grey55');
points(1, (mAdH-mAdL)[2], pch=16, col='grey55');
points(1, IC2[[2]][2,1], col=rainbow(2*6)[9], pch=16);
points(1, IC2[[2]][2,2], col=rainbow(2*6)[10], pch=16);
abline(h=0)
boxplot(plastic3[,3]~Ex,   main='Fact.: Extrusion (Opacity)'  , ylab='Op', col=rainbow(2*6)[c(5,6)], ylim=c(-2,10))
plot(c(1,g*(g-1)/2),range(IC2[[1]][3,]), pch='',main='IC (tau.1-tau.2)[3]',xlab='pairs treat', ylab='IC (tau.1-tau.2)[3]', ylim=c(-2,10))
lines(c(1,1), c(IC2[[1]][3,1],IC2[[1]][3,2]), col='grey55');
points(1, (mExH-mExL)[3], pch=16, col='grey55');
points(1, IC2[[1]][3,1], col=rainbow(2*6)[5], pch=16);
points(1, IC2[[1]][3,2], col=rainbow(2*6)[6], pch=16);
abline(h=0)
boxplot(plastic3[,3]~Ex,   main='Only Factor Additive (Opacity)'  , ylab='Op', col=rainbow(2*6)[c(11,12)], ylim=c(-2,10))
plot(c(1,g*(g-1)/2),range(IC2[[2]][3,]), pch='',main='IC (beta.1-beta.2)[3]',xlab='pairs treat', ylab='IC beta.1[3]', ylim=c(-2,10))
lines(c(1,1), c(IC2[[2]][3,1],IC2[[2]][3,2]), col='grey55');
points(1, (mAdH-mAdL)[3], pch=16, col='grey55');
points(1, IC2[[2]][3,1], col=rainbow(2*6)[11], pch=16);
points(1, IC2[[2]][3,2], col=rainbow(2*6)[12], pch=16);
abline(h=0)
library(MVN)
library(car)
library(heplots)
## One-way MANOVA ------------------------------------------------------------------------------
# Example: Iris dataset (p=4, g=3)
# Variables: Sepal and Petal Length and Sepal and Petal Width of iris (p = 4)
# Groups: species (setosa, versicolor, virginica; g = 3)
# n1 = n2 = n3 = 50 (balanced design)
help(iris)
head(iris)
dim(iris)
attach(iris)
species.name <- factor(Species, labels=c('setosa','versicolor','virginica'))
iris4        <- iris[,1:4] # variables
### Data exploration
colore <- rep(rainbow(3), each = 50)
pairs(iris4, col = colore, pch=16)
i1 <- which(species.name=='setosa')
i2 <- which(species.name=='versicolor')
i3 <- which(species.name=='virginica')
par(mfrow=c(1,3))
boxplot(iris4[i1,], main='SETOSA',     ylim=c(0,8), col = rainbow(4))
boxplot(iris4[i2,], main='VERSICOLOR', ylim=c(0,8), col = rainbow(4))
boxplot(iris4[i3,], main='VIRGINICA',  ylim=c(0,8), col = rainbow(4))
par(mfrow=c(1,4))
boxplot(iris4[,1]~species.name, main='Sepal Length', ylim=c(0,8), col = rainbow(3))
boxplot(iris4[,2]~species.name, main='Sepal Width', ylim=c(0,8), col = rainbow(3))
boxplot(iris4[,3]~species.name, main='Petal Length', ylim=c(0,8), col = rainbow(3))
boxplot(iris4[,4]~species.name, main='Petal Width', ylim=c(0,8), col = rainbow(3))
n1 <- length(i1)
n2 <- length(i2)
n3 <- length(i3)
n  <- n1 + n2 + n3
g  <- length(levels(species.name))
p  <- 4
### Verify the assumptions:
# 1)  normality (multivariate) in each group (3 tests)
Ps <- NULL
for(i in 1:g) {
mvn.test <- mvn(data = iris[get(paste('i',i, sep='')), 1:4])
Ps <- c(Ps, mvn.test$multivariateNormality$`p value`)
}
Ps
# 2) same covariance structure (= same covariance matrix Sigma)
S  <-  cov(iris4)
S1 <-  cov(iris4[i1,])
S2 <-  cov(iris4[i2,])
S3 <-  cov(iris4[i3,])
# Qualitatively:
round(S1, digits=2)
round(S2, digits=2)
round(S3, digits=2)
# Box's M test for homogeneity of covariance matrices
# Should be done only if n_i > ~20 for all i, p < 5 and g < 5
# WARNING: Very sensitive to departure from normality and too restrictive for MANOVA
# especially if we have a high number of samples
summary(boxM(iris4, species.name))
# Other way to compare: heatmap on the covariance matrices
par(mfrow=c(1,3))
image(S1, col=heat.colors(100),main='Cov. S1', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3), (0:100)/100, na.rm=TRUE))
image(S2, col=heat.colors(100),main='Cov. S2', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3), (0:100)/100, na.rm=TRUE))
image(S3, col=heat.colors(100),main='Cov. S3', asp=1, axes = FALSE, breaks = quantile(rbind(S1,S2,S3), (0:100)/100, na.rm=TRUE))
par(mfrow=c(1,1))
# One-way MANOVA
help(manova)
help(summary.manova)
fit <- manova(as.matrix(iris4) ~ species.name)
summary.manova(fit)
# Via ANOVA: for each of the p=4 variables we perform an ANOVA test
#            to verify if the membership to a group has influence
#            on the mean of the variable (we explore separately the
#            4 axes directions in R^4)
summary.aov(fit)
### Via Bonferroni
alpha <- 0.05
k <- p * g * (g - 1) / 2
qT <- qt(1 - alpha / (2 * k), n - g)
W <- summary.manova(fit)$SS$Residuals
m  <- sapply(iris4, mean)         # estimates mu
m
m1 <- sapply(iris4[i1,], mean)    # estimates mu.1 = mu + tau.1
m2 <- sapply(iris4[i2,], mean)    # estimates mu.2 = mu + tau.2
m3 <- sapply(iris4[i3,], mean)    # estimates mu.3 = mu + tau.3
m-m1
m-m2
library(MVN)
library(car)
library(heplots)
help(chickwts)
head(chickwts)
dim(chickwts)
summary(chickwts)
attach(chickwts)
# Group-wise boxplot
plot(feed, weight, xlab='treat', ylab='weight', col='grey85',
main='Dataset Chicken Weights')
# Plot showing the estimator for the mean in H0 and a particular case of H1
# where we assume that there are as much populations as groups
par(mfrow=c(1,2))
barplot(rep(mean(weight),6), names.arg=levels(feed), ylim=c(0, max(weight)),
las=2, col='grey85', main='Model under H0')
barplot(tapply(weight, feed, mean), names.arg=levels(feed), ylim=c(0, max(weight)),
las=2, col=rainbow(6), main='Model under a special case of
H1 with 6 populations')
par(mfrow=c(1,1))
# This is a case of one-way ANOVA: one variable (weight) observed
# over g=6 levels (feed)
n       <- length(feed)      # total number of obs.
ng      <- table(feed)       # number of obs. in each group
treat   <- levels(feed)      # levels of the treatment
g       <- length(treat)     # number of levels (i.e., of groups)
### verify the assumptions:
# 1) normality (univariate) in each group (6 tests)
Ps <- c(shapiro.test(weight[feed==treat[1]])$p,
shapiro.test(weight[feed==treat[2]])$p,
shapiro.test(weight[feed==treat[3]])$p,
shapiro.test(weight[feed==treat[4]])$p,
shapiro.test(weight[feed==treat[5]])$p,
shapiro.test(weight[feed==treat[6]])$p)
Ps
# 2) same covariance structure (= same sigma^2)
Var <- c(var(weight[feed==treat[1]]),
var(weight[feed==treat[2]]),
var(weight[feed==treat[3]]),
var(weight[feed==treat[4]]),
var(weight[feed==treat[5]]),
var(weight[feed==treat[6]]))
Var
# test of homogeneity of variances for normal samples (Bartlett's test)
# H0: sigma.1 = sigma.2 = sigma.3 = sigma.4 = sigma.5 = sigma.6
# H1: there exist i,j s.t. sigma.i!=sigma.j
# WARNING: Test extremely sensitive to departures from normality (low robustness)
# Normality assumption mandatory
bartlett.test(weight, feed)
# One-way ANOVA
help(aov)
fit <- aov(weight ~ feed)
summary(fit)
# We reject the test, i.e., we have evidence to state that the
# treatment (feed supplement) has an effect on the growth rate
# of chicken.
# Which supplement is responsible for this? To see this, we need to
# do g * (g - 1) / 2 comparisons.
# We use Bonferroni
k <- g * (g - 1) / 2
alpha = 0.05
Mediag  <- tapply(weight, feed, mean) # group-wise means
SSres <- sum(residuals(fit) ^ 2)
S <- SSres / (n - g)
# Example: CI for the difference "casein - horsebean"
paste(treat[1],"-",treat[2])
as.numeric(c(Mediag[1]-Mediag[2] - qt(1-alpha/(2*k), n-g) * sqrt(S * ( 1/ng[1] + 1/ng[2])),
Mediag[1]-Mediag[2] + qt(1-alpha/(2*k), n-g) * sqrt(S * ( 1/ng[1] + 1/ng[2]))))
# CI for all the differences
ICrange=NULL
for(i in 1:(g-1)) {
for(j in (i+1):g) {
print(paste(treat[i],"-",treat[j]))
print(as.numeric(c(Mediag[i]-Mediag[j] - qt(1-alpha/(2*k), n-g) * sqrt(S * ( 1/ng[i] + 1/ng[j])),
Mediag[i]-Mediag[j] + qt(1-alpha/(2*k), n-g) * sqrt(S * ( 1/ng[i] + 1/ng[j])))))
ICrange=rbind(ICrange,as.numeric(c(Mediag[i]-Mediag[j] - qt(1-alpha/(2*k), n-g) * sqrt(S * (1/ng[i] + 1/ng[j])),
Mediag[i]-Mediag[j] + qt(1-alpha/(2*k), n-g) * sqrt(S * (1/ng[i] + 1/ng[j])))))
}}
par(mfrow=c(1,2))
plot(feed, weight, xlab='treat', ylab='weight', col = rainbow(6), las=2)
h <- 1
plot(c(1,g*(g-1)/2),range(ICrange), pch='',xlab='pairs treat', ylab='Conf. Int. tau weight')
for(i in 1:(g-1)) {
for(j in (i+1):g) {
ind <- (i-1)*g-i*(i-1)/2+(j-i)
lines (c(h,h), c(ICrange[ind,1],ICrange[ind,2]), col='grey55');
points(h, Mediag[i]-Mediag[j], pch=16, col='grey55');
points(h, ICrange[ind,1], col=rainbow(6)[j], pch=16);
points(h, ICrange[ind,2], col=rainbow(6)[i], pch=16);
h <- h+1
}}
abline(h=0)
par(mfrow=c(1,1))
# We build k one-at-a-time confidence intervals, each of level alpha
# (not including the Bonferroni correction)
Auni <- matrix(0,6,6)
for(i in 1:6) {
for(j in i:6) {
Auni[i,j] <- Mediag[i]-Mediag[j] + qt(1-alpha/2, n-g) * sqrt( S * ( 1/ng[i] + 1/ng[j] ) )}
for(j in 1:i) {
Auni[i,j] <- Mediag[j]-Mediag[i] - qt(1-alpha/2, n-g) * sqrt( S * ( 1/ng[i] + 1/ng[j] ) )}
Auni[i,i]     <- 0
}
par(mfrow=c(1,2))
h <- 1
plot(c(1,g*(g-1)/2),range(Auni), pch='', xlab='pairs treat',
ylab='CI delta weight', main='Univariate Conf. Int.', col='grey55')
for(i in 1:5) {
for(j in (i+1):6) {lines (c(h,h), c(Auni[i,j],Auni[j,i]));
points(h, Mediag[i]-Mediag[j], pch=16, col='grey55');
points(h, Auni[i,j], col=rainbow(6)[i], pch=16);
points(h, Auni[j,i], col=rainbow(6)[j], pch=16);
h <- h+1
}}
abline(h=0)
# Matrix of tests for the difference between all the pairs
P <- matrix(0,6,6)
for(i in 1:6) {
for(j in i:6) {
P[i,j] <- (1-pt(abs((Mediag[i]-Mediag[j]) / sqrt( S * ( 1/ng[i] + 1/ng[j] ) ) ), n-g))*2}
for(j in 1:i) {
P[i,j] <- (1-pt(abs((Mediag[i]-Mediag[j]) / sqrt( S * ( 1/ng[i] + 1/ng[j] ) ) ), n-g))*2}
P[i,i]     <- 0
}
P
# Vector of p-values
p <- c(P[1, 2:6], P[2, 3:6], P[3, 4:6], P[4, 5:6], P[5, 6])
p
plot(1:15, p, ylim=c(0,1), type='b', pch=16, col='grey55', xlab='pairs treat',
main='P-values')
abline(h=alpha, lty=2)
table(chick$feed)
table(chicken$feed)
table(chicken$feed)
table(chickwts$feed)
